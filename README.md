# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами  
- src/index.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в проекте

Карточка

```
export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
	index?: number;
}
```

Тип категорий карточек
```
export type cardCategoryType = "софт-скил"|"другое"|"дополнительное"|"кнопка"|"хард-скил"
```

Пользователь
```
export interface IOrderUser {
	payment: IPayment;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Объект данных пользователя при оформлении заказа в POST запросе
```
export interface IOrderPost {
	payment: string;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Ответ с сервера после оформления заказа
```
export interface IOrderResponse {
	id: string;
	total: number;
}
```

Список карточек
```
export interface IProductList {
	total: number;
	items: IProductItem[];
}
```


Данные ответа сервера - оформленного заказа 
```
export interface IOrderServer {
	id: string;
	total: number;
}
```

Типы для объекта с ошибками для валидации форм
```
export interface IOrderForm {
	address?: string;
	payment?: string;
	phone?: string;
	email?: string;
}
```

Интерфейс для метода валидации форм
```
export interface IOrderValidate {
	payment: string,
	address: string
	email: string
	phone: string
}
```

## Архитектура приложения

Код приложения разделен на слои согласно архитектуре MVP: 
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь слоёв представления и данных. Роль презентера, выполняет фаил index.ts.

### Базовый код 

#### Класс Api отвечает за работу с сервером.


Конструктор класса:\
`baseUrl: string` - базовый Url для подключения к серверу.\
`options: RequestInit` - набор настроек для доступа к параметрам запроса.

Методы класса:\
`handleResponse` - выполняет проверку и обрабатывает ответ с сервера.\
`get` - выполняет GET запрос на заданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер\
`post` - принимает объект с данными которые будут переданны в JSON в теле запроса.\
Эндпоинт куда будут отправляться данные.\
Метод запроса по умолчанию `POST` но может быть переопределен, передачей в третьем аргументе. 


#### Класс EventEmitter

Брокер событий, позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Основные методы реализуемые классом описанны интерфейсом IEvents:
- `on` - подписка на событие,
- `off` - отписка от события,
- `emit` - инициализация события,
- `trigger` - возвращает функцию при вызове которой, инициализируется требуемое в параметрах событие.  

#### Класс Component 
Абстрактный класс для работы с DOM элементами в дочерних компонентах. 


#### Класс Model

Базовая модель, чтобы можно было отличить ее от простых объектов с данными. Для работы с дочерним классом модели данных.



### Код компонентов отображения

#### Класс Basket
```
interface IBasket {
	list: HTMLElement[];
	total: string;
}
```

Отвечает за отображение корзины. Наследуется от абстрактного класса Component. 
В конструктор передаются контейнер в котором находится разметка корзины и брокер событий. 

Содержит сеттеры:\
`list` -  для вывода карточек в разметку\
`total` - для вывода общей цены товаров находящихся в корзине

#### Класс Card 
Отвечает за отображение карточек на главной странице, превью и в корзине, содерит сеттеры и геттеры для получения и установки значения:
- заголовка
- цены товара
- категории товара
- id карточки
- ссылки на изображение карточки
- индекса в корзине
- текста в кнопке превью
- категории товара

Методы:\
`toogleButtonText(value: boolean)` - для актуального отображения кнопки карточки.\
`categoryColor(value: cardCategoryType)` - для установки категории товара, нужного цвета. 

#### Класс Form

Интерфейс:
```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```
Класс для форм, в котором вешаются обработчики на контейнер, для отслеживания событий инпутов. 

Содержит метод:\
`oninputChange(field: keyof T, value:string):void` - для инициализации собития изменения инпутов, аргументами передается поле в котором произошло событие и данные из этого поля.\
`render(state: Partial<T> & IFormState):HTMLFormElement` - для рендера формы.\
`clearForm():void` - для очистки формы.

Содержит сеттеры для валидации формы и вывода текста ошибок. 

#### Класс Contacts

Интерфейс:
```
interface IContacts {
  phone: string;
  email: string;
}
```

Наследуется от класса `Form`, предназначен для работы с формой, собирающие данные покупателя.

Сеттеры:\
`phone` - для установки значений в инпут phone.\
`email` - для установки значений в инпут email.


#### Класс Order

Интерфейс:
```
interface IOrder {
  adress: string;
  paymant: string;
}
```

Класс для работы с формой заказа. 
Предназначен для выбора способа оплаты и получения адреса покупателя. 

Сеттеры:\
`adress` - для установки значений в инпут adress.\
`paymant` - для переключения класса активной кнопки.

Метод:\
`clearForm()` - используется для очистки полей формы и сброса состояния кнопок.

#### Класс Modal

Интерфейс:
```
interface IModal {
  content: HTMLElement;
}
```

Класс для отображения модального окна.\
В конструктор принимает контейнер и брокер событий.

Содержит сеттер:\
`content` - для установки элементов отображения в модальное окно.

Методы:\
`open()` - для открытия модального окна.\
`close()` - закрытия модального окна.\
`render` - для установки значений в поля класса и открытия модального окна.


#### Класс Page 

Интерфейс:
```
interface IPage {
  counter: number,
  catalog: HTMLElement[],
}
```

Класс для глобального контейнера, отвечает за отображение элементов на странице. 

Содержит сеттеры:\
`counter` - устанавливает значение в поле счетчика корзины. Отображает количество товаров в корзине.\
`catalog` - отвечает за отображение списка карточек в каталоге.\
`locked` - для блокировки страницы от прокрутки. 

#### Класс Sucsess

Интерфейс:
```
interface ISucsess {
	total: number;
}
```
Класс для отображения окна успешной оплаты. 

Содержит сеттер:\
`total` - для отображения текста, о списанной сумме. 

#### Класс AppApi
Надстройка над базовым классом Api.\
Содержит необходимые методы для работы приложения с сервером:\
`getCards(): Promise<IProductItem[]>` - GET-запрос для получения карточек с сервера.\
`postOrder(data: IOrderPost): Promise<IOrderResponse>` - POST-запрос для отправки объекта заказа и получения данных оформленного заказа. 


### Код модели данных

#### Класс CardData 
Интерфейс:

```
interface ICardData {
	catalog: IProductItem[];
	basket: IProductItem[];
	events: IEvents;
	order: IUserModel;
	formErrors: IOrderForm;
	setCatalog(cards: IProductItem[]): void;
	getCatalog(): IProductItem[];
	addToOrder(): void;
	totalPrice(): number;
	addItem(element: IProductItem): void | IProductItem;
	deleteItem(id: string): void;
	inBasket(id: string): boolean;
	getBasket(): IProductItem[];
	clearBasket(): void;
	clearOrder(): void;
	setOrder(field: keyof IOrderValidate, value: string): void;
	validateOrderForm(): void;
	validateContactForm(): void;
}
```

Используется для работы с данными приложения.\
Собержит сеттеры для определения длинны массива карточек в корзине(количество заказанных товаров),\
вывода массива с карточками на главную страницу. 

Методы:\
`totalPrice()` - рассчитать общую сумму заказанных товаров товаров в корзине.\
`addItem(element: IProductItem):void|IProductItem` - добавить товар в корзину.\
`clearBasket()` - очистить корзину.\
`setCatalog(cards: IProductItem[])` - установить каталог.\
`getCatalog()` - олучить каталог.\
`addToOrder()` - для присвоения id товаров и итоговой суммы заказа в объект заказа покупателя.\
`deleteItem(id: string)` - удаление товара из корзины.\
`inBasket(id: string)` - для проверки есть ли продукт в массиве корзины.\
`getBasket()` - получить каталог корзины.\
`clearOrder()`- очистить объект заказа для отправки на сервер.\
`setOrder(field: keyof IOrderValidate, value: string)` - заполнение объекта пользователя для отправки на сервер.\
`validateOrderForm()` - валидация формы с табсами.\
`validateContactForm()` - валидация формы с даными покупателя.



### События
`catalog:changed` - событие при выводе карточек в каталог.\
`card:select` - при клике на карточку в каталоге и появления превью.\
`basket:toggleItem` - при клике в превью на кнопку добавить в корзину и переключении кнопки на "Удалить из корзины" если карточка в корзине уже есть.\
`basket:open` - при клике на кнопку корзины на главной странице, и открытии окнна с корзиной.\
`basket:deleteItem` - при клике на кнопку удаления товара в корзине.\
`basket:order` - при клике на кнопку далее, в корзине, если товары есть.\
`orderErrors:change` - при валидации формы Order.\
`contactErrors:change` - при валидации формы Contact.\
`order.payment:change` - при добавлении способа оплаты, в объект заказа.\
`order.address:change` - при добавлении адреса, в объект заказа.\
`contacts.email:change` - при добавлении почты, в объект заказа.\
`contacts.phone:change` - при добавлении телефона, в объект заказа.\
`order:submit` - при клике на кнопку "Далее" в форме способа оплаты.\
`contacts:submit` - при клике на кнопку "Оплатить" в форме ввода почты и телефона и отправке на сервер объекта заказа.\
`order:complete` - при открытии окна успешной оплаты.\
`order:finish` - для закрытия окна успешной оплаты.\
`modal:close` - для разблокировки окна после закрытия формы. 
`modal:open` - для блокировки страницы при открытии модального окна.