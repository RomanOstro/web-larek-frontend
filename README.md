# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами  
- src/index.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в проекте

Карточка

```
export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Пользователь
```
export interface IOrderUser {
	payment: IPayment;
	address: string;
	email: string;
	phone: string;
	total: number;
	items: string[];
}
```

Список карточек
```
export interface IProductList {
	total: number;
	items: IProductItem[];
}
```

Данные карточи для каталога товаров
```
export type ICatalogItem = Omit<IProductItem, 'description'>;
```

Данные для превью карточки
```
export type IPreviewItem = IProductItem;
```

Данные карточки для отображения в корзине
```
export type IBasketItem = Pick<IProductItem, 'id' | 'title' | 'price'>;
```

Данные ответа сервера - оформленного заказа 
```
export interface IOrderServer {
	id: string;
	total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно архитектуре MVP: 
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь слоёв представления и данных.

### Базовый код 

#### Класс Api отвечает за работу с сервером.


Конструктор класса:\
`baseUrl: string` - базовый Url для подключения к серверу.\
`options: RequestInit` - набор настроек для доступа к параметрам запроса.

Методы класса:\
`handleResponse` - выполняет проверку и обрабатывает ответ с сервера.\
`get` - выполняет GET запрос на заданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер\
`post` - принимает объект с данными которые будут переданны в JSON в теле запроса.\
Эндпоинт куда будут отправляться данные.\
Метод запроса по умолчанию `POST` но может быть переопределен, передачей в третьем аргументе. 


#### Класс EventEmitter

Брокер событий, позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Основные методы реализуемые классом описанны интерфейсом IEvents:
- `on` - подписка на событие,
- `off` - отписка от события,
- `emit` - инициализация события,
- `trigger` - возвращает функцию при вызове которой, инициализируется требуемое в параметрах событие.  

#### Класс Component 
Абстрактный класс для работы с DOM элементами в дочерних компонентах. 


#### Класс Model

Базовая модель, чтобы можно было отличить ее от простых объектов с данными. Для работы с дочерним классом модели данных.



### Код компонентов отображения

#### Класс Basket

Отвечает за отображение корзины. Наследуется от абстрактного класса Component. 
В конструктор передаются контейнер в котором находится разметка корзины и брокер событий. 

Содержит сеттеры:\
`cards` -  для вывода карточек в разметку\
`total` - для вывода общей цены товаров находящихся в корзине

#### Класс Card 
Отвечает за отображение карточек на главной странице, содерит сеттеры и геттеры для получения и установки значения:
- заголовка
- цены товара
- категории товара
- id карточки
- установки ссылки на изображение карточки

##### Дочерний класс CaprPreview (наследуется от Card)
Отвечает за показ превью карточки. 
Содержит сеттер для:
- Описания товара 


#### Класс Form

Интерфейс:
```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```
Класс для форм, в котором вешаются обработчики на контейнер, для отслеживания событий инпутов. 

Содержит метод:\
`oninputChange(field: keyof T, value:string)` - для инициализации собития изменения инпутов, аргументами передается поле в котором произошло событие и данные из этого поля. 

Содержит сеттеры для валидации формы и вывода текста ошибок. 

#### Класс Contacts

Интерфейс:
```
interface IContacts {
  phone: string;
  email: string;
}
```

Наследуется от класса `Form`, предназначен для работы с формой, собирающие данные покупателя.

Сеттеры:\
`phone` - для установки значений в инпут phone.\
`email` - для установки значений в инпут email.

Метод:\
`clearForm()` - используется для очистки полей формы

#### Класс Order

Интерфейс:
```
interface IOrder {
  adress: string;
  paymant: string;
}
```

Класс для работы с формой заказа. 
Предназначен для выбора способа оплаты и получения адреса покупателя. 

Сеттеры:\
`adress` - для установки значений в инпут adress.\
`paymant` - для переключения класса активной кнопки.

Метод:\
`clearForm()` - используется для очистки полей формы и сброса состояния кнопок.

#### Класс Modal

Интерфейс:
```
interface IModal {
  content: HTMLElement;
}
```

Класс для отображения модального окна.\
В конструктор принимает контейнер и брокер событий.

Содержит сеттер:\
`content` - для установки элементов отображения в модальное окно.

Методы:\
`open()` - для открытия модального окна.\
`close()` - закрытия модального окна.\
`render` - для установки значений в поля класса.


#### Класс Page 

Интерфейс:
```
interface IPage {
  counter: number,
  catalog: HTMLElement[],
}
```

Класс для глобального контейнера, отвечает за отображение элементов на странице. 

Содержит сеттеры:\
`counter` - устанавливает значение в поле счетчика корзины. Отображает количество товаров в корзине.\
`catalog` - отвечает за отображение списка карточек в каталоге.



#### Класс CardData
Интерфейс: 
```
interface ICardData {
	catalog: IProductItem[];
	basket: IProductItem[];
	events: IEvents;
	getCatalog(): IProductList;
	setCatalog(data: IProductList):void;
	totalPrice():number;
	allOrderId():void;
	clearBasket(): void;
	
}
```

Класс для работы с данными приложения. 

Отвечает за данные корзины, каталога, покупателя. 

Содержит методы:\
`getCard` - получение карточки по id;\
`totalPrice` - получение суммы всех товаров в корзине;\
`allOrderId` - получение массива id заказанных товаров.\
`addItem` - добавления карточки в массив корзины.\
`clearBasket` - очистка массива корзины.


### Код модели данных

#### Класс CardData 
Интервейс:\

```
export interface ICardData {
	catalog: IProductItem[];
	basket: IProductItem[];
	events: IEvents;
	getCatalog(): IProductList;
	setCatalog(data: IProductList):void;
	totalPrice():number;
	allOrderId():void;
	clearBasket(): void;
	
}
```

Используется для работы с данными приложения.\
Собержит сеттеры для определения длинны массива карточек в корзине(количество заказанных товаров),\
вывода массива с карточками на главную страницу. 

Методы:\
`getCard(cardId: string)` - Получить карточку по id.\
`totalPrice()` - рассчитать общую сумму заказанных товаров товаров в корзине.\
`allOrderId()` - создать массив с id заказанных товаров.\
`addItem(element: IProductItem):void|IProductItem` - добавить товар в корзину.\
`clearBasket()` - очистить корзину.









#### События
`order:open` - при нажатии на кнопку "Оформить" в корзине.




















<!-- Класс Component - базовый абстрактный класс, содержит набор необходимых методов для работы с отображением компонента. Класс использует дженерик - <T> который нужен для описания типов данных которые будут использоваться в компоненте.

Конструктор класса (protected readonly container: HTMLElement) - принимает DOM элемент, в который будет вставлен компонент.

Методы класса:
toggleClass - переключает класс DOM элемента.
setText - устанавливает текстовое содержимое в DOM элемент. -->
